name: "Cutter Management System"

on:
    push:
        tags:
          - "v*"

jobs:
    deploy:
        runs-on: windows-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v3

            - name: Dotnet setup
              uses: actions/setup-dotnet@v3
              with:
                    dotnet-version: '8.0.x'
        
            - name: Restoring dependencies
              # run: dotnet restore CutterManagementSystem.sln
              run: dotnet restore CutterManagement.UI.Desktop/CutterManagement.UI.Desktop.csproj -r win-x64

            - name: Building solution
              run: dotnet build CutterManagementSystem.sln -c Release --no-restore

            - name: Publishing application
              # run: dotnet publish CutterManagementSystem/CutterManagementSystem.csproj --c Release --self-contained -r win-x64 -p:PublishSingleFile=true --no-build -o ./publish
              run: dotnet publish CutterManagement.UI.Desktop/CutterManagement.UI.Desktop.csproj -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true -p:IncludeNativeLibrariesForSelfExtract=true --no-build -o ./publish

            - name: Zipping the published folder
              run: zip -r CutterManagementSystem.zip .bin/Release/net8.0-windows/win-x64/publish

            - name: Uploading the zipped folder as a release
              uses: softprops/action-gh-release@v1
              with:
                files: CutterManagementSystem.zip